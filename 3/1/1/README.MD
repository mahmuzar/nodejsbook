–ü–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞—à –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ TypeScript ‚Äî —ç—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, —É–ø—Ä–æ—Å—Ç–∏—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–∏–±–ª–∏–∑–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫ enterprise-–ø–æ–¥—Ö–æ–¥—É (–≤ –¥—É—Ö–µ Spring Boot).
____

## ‚úÖ –¶–µ–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ TypeScript:

- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- –ß—ë—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è DTO, –º–æ–¥–µ–ª–µ–π, —Å–µ—Ä–≤–∏—Å–æ–≤
- –õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IDE (–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [C—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-C—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#–£—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
4. [tsconfig.json](#tsconfig.json)
5. [–¢–∏–ø—ã –∏ –º–æ–¥–µ–ª–∏](#–¢–∏–ø—ã-–∏-–º–æ–¥–µ–ª–∏)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
7. [–£—Ç–∏–ª–∏—Ç—ã](#–£—Ç–∏–ª–∏—Ç—ã)
8. [–°–µ—Ä–≤–∏—Å](#–°–µ—Ä–≤–∏—Å)
9. [Middleware](#Middleware)
10. [–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã](#–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)
11. [–†–æ—É—Ç—ã](#–†–æ—É—Ç—ã)
12. [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–µ—Ä–≤–µ—Ä](#–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–∏-—Å–µ—Ä–≤–µ—Ä)
13. [–ó–∞–ø—É—Å–∫](#–ó–∞–ø—É—Å–∫)
14. [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞](#-–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞)
15. [–ß—Ç–æ –¥–∞–ª—å—à–µ?](#-–ß—Ç–æ-–¥–∞–ª—å—à–µ)

## [‚Üë](#–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ) üìÅ C—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

auth-user-service/
```csv
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.ts
‚îÇ   ‚îú‚îÄ‚îÄ server.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.middleware.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.routes.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.controller.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userService.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ User.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fileDb.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îî‚îÄ‚îÄ index.ts          // –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–ª–∏ –æ–±—â–∏–µ —Ç–∏–ø—ã
‚îÇ
‚îú‚îÄ‚îÄ data/                      // (–Ω–µ –≤ src) ‚Äî –¥–ª—è users.json
‚îÇ   ‚îî‚îÄ‚îÄ users.json
‚îÇ
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

## [‚Üë](#–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm init -y

# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install express bcryptjs jsonwebtoken express-rate-limit morgan dotenv

# –¢–∏–ø—ã –¥–ª—è TypeScript
npm install -D typescript ts-node @types/node @types/express

# –¢–∏–ø—ã –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫
npm install -D @types/bcryptjs @types/jsonwebtoken
```

> üí° ts-node –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å .ts —Ñ–∞–π–ª—ã –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": false,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
```

## –¢–∏–ø—ã –∏ –º–æ–¥–µ–ª–∏
src/models/User.ts

```ts
export interface User {
  id: number;
  username: string;
  password: string; // —Ö–µ—à
}
```

src/types/index.ts

```ts
export interface AuthRequest extends Request {
  user?: JwtPayload;
}

export interface JwtPayload {
  id: number;
  username: string;
  iat: number;
  exp: number;
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

src/config/index.ts
```ts
import dotenv from 'dotenv';
dotenv.config();

export const config = {
  port: parseInt(process.env.PORT || '3001', 10),
  jwtSecret: process.env.JWT_SECRET || 'supersecret',
  dbPath: process.env.DB_PATH || './data/users.json'
};
```

## –£—Ç–∏–ª–∏—Ç—ã

src/utils/fileDb.ts

```ts
import * as fs from 'fs';
import * as path from 'path';
import { config } from '../config';
import { User } from '../models/User';

const DB_FILE = path.resolve(config.dbPath);

function ensureDbExists(): void {
  const dir = path.dirname(DB_FILE);
  if (!fs.existsSync(dir)) {
    fs.mkdirSync(dir, { recursive: true });
  }
  if (!fs.existsSync(DB_FILE)) {
    fs.writeFileSync(DB_FILE, '[]');
  }
}

export function readUsers(): User[] {
  ensureDbExists();
  const data = fs.readFileSync(DB_FILE, 'utf8');
  return JSON.parse(data || '[]') as User[];
}

export function writeUsers(users: User[]): void {
  ensureDbExists();
  fs.writeFileSync(DB_FILE, JSON.stringify(users, null, 2));
}
```

## –°–µ—Ä–≤–∏—Å

src/services/userService.ts

```ts
import * as bcrypt from 'bcryptjs';
import * as jwt from 'jsonwebtoken';
import { config } from '../config';
import { User } from '../models/User';
import { readUsers, writeUsers } from '../utils/fileDb';

export async function hashPassword(password: string): Promise<string> {
  return bcrypt.hash(password, 10);
}

export async function comparePassword(plain: string, hashed: string): Promise<boolean> {
  return bcrypt.compare(plain, hashed);
}

export function generateToken(user: Pick<User, 'id' | 'username'>): string {
  return jwt.sign(
    { id: user.id, username: user.username },
    config.jwtSecret,
    { expiresIn: '1h' }
  );
}

export async function registerUser(username: string, password: string): Promise<User> {
  const users = readUsers();
  if (users.some(u => u.username === username)) {
    throw new Error('USER_EXISTS');
  }
  const hashedPassword = await hashPassword(password);
  const newUser: User = {
    id: Date.now(),
    username,
    password: hashedPassword
  };
  users.push(newUser);
  writeUsers(users);
  return newUser;
}

export function findUserByUsername(username: string): User | undefined {
  const users = readUsers();
  return users.find(u => u.username === username);
}
```

## Middleware
src/middlewares/auth.middleware.ts

```ts
import { NextFunction, Response } from 'express';
import * as jwt from 'jsonwebtoken';
import { config } from '../config';
import { AuthRequest, JwtPayload } from '../types';

export function authenticateToken(req: AuthRequest, res: Response, next: NextFunction): void {
  const authHeader = req.headers['authorization'];
  const token = authHeader?.split(' ')[1]; // Bearer TOKEN

  if (!token) {
    res.status(401).json({ error: '–¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' });
    return;
  }

  jwt.verify(token, config.jwtSecret, (err, decoded) => {
    if (err) {
      res.status(403).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω' });
      return;
    }
    req.user = decoded as JwtPayload;
    next();
  });
}
```

## –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
src/controllers/auth.controller.ts

```ts
import { Request, Response } from 'express';
import {
  registerUser,
  findUserByUsername,
  comparePassword,
  generateToken
} from '../services/userService';

export async function register(req: Request, res: Response): Promise<void> {
  const { username, password } = req.body;

  if (!username || !password) {
    res.status(400).json({ error: '–¢—Ä–µ–±—É—é—Ç—Å—è username –∏ password' });
    return;
  }

  try {
    const user = await registerUser(username, password);
    const token = generateToken(user);
    res.status(201).json({
      token,
      user: { id: user.id, username: user.username }
    });
  } catch (err: any) {
    if (err.message === 'USER_EXISTS') {
      res.status(409).json({ error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' });
      return;
    }
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' });
  }
}

export async function login(req: Request, res: Response): Promise<void> {
  const { username, password } = req.body;

  if (!username || !password) {
    res.status(400).json({ error: '–¢—Ä–µ–±—É—é—Ç—Å—è username –∏ password' });
    return;
  }

  const user = findUserByUsername(username);
  if (!user) {
    res.status(401).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ' });
    return;
  }

  const isMatch = await comparePassword(password, user.password);
  if (!isMatch) {
    res.status(401).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ' });
    return;
  }

  const token = generateToken(user);
  res.json({
    token,
    user: { id: user.id, username: user.username }
  });
}
```

## –†–æ—É—Ç—ã
src/routes/auth.routes.ts

```ts
import { Router } from 'express';
import { register, login } from '../controllers/auth.controller';

const router = Router();

router.post('/register', register);
router.post('/login', login);

export default router;
```

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–µ—Ä–≤–µ—Ä
src/app.ts

```ts
import express, { Application } from 'express';
import morgan from 'morgan';
import rateLimit from 'express-rate-limit';
import authRoutes from './routes/auth.routes';
import userRoutes from './routes/user.routes';
import { config } from './config';
import { authenticateToken } from './middlewares/auth.middleware';

const app: Application = express();

app.use(express.json());
app.use(morgan('combined'));

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 100,
  message: { error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —ç—Ç–æ–≥–æ IP' }
});
app.use(limiter);

// –†–æ—É—Ç—ã
app.use('/auth', authRoutes);
app.use('/api', authenticateToken, userRoutes); // –≤—Å–µ /api ‚Äî –∑–∞—â–∏—â–µ–Ω—ã

app.get('/health', (req, res) => {
  res.json({ status: 'OK', uptime: process.uptime() });
});

export default app;
```

src/server.ts

```ts
import app from './app';
import { config } from './config';

app.listen(config.port, () => {
  console.log(`üîê Auth microservice –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${config.port}`);
});
```

## 11. [–ó–∞–ø—É—Å–∫](#11)

–î–æ–±–∞–≤—å –≤ package.json:

```ts
{
  "scripts": {
    "dev": "ts-node src/server.ts",
    "start": "node dist/server.js",
    "build": "tsc"
  }
}
```

–ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
npm run dev
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü–æ–ª–Ω–∞—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞
- –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma, TypeORM –∏–ª–∏ NestJS –≤ –±—É–¥—É—â–µ–º
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ CI/CD

## üîú –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —É–ª—É—á—â–µ–Ω–∏—é
____

- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å Zod –∏–ª–∏ express-validator + TypeScript?
- –ü–µ—Ä–µ–π—Ç–∏ –æ—Ç fileDb –∫ PostgreSQL + Prisma?
- –ù–∞–ø–∏—Å–∞—Ç—å Dockerfile –∏ docker-compose.yml? –ï—Å–ª–∏ —Ä–∞–∑—É–µ—Ä–Ω—É—Ç kubernetes —Ç–æ —Å—Ä–∞–∑—É —Ç—É–¥–∞ –≤ —Å–≤—è–∑–∫–µ —Å jenkins
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å refresh tokens?
- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—ë –≤ NestJS (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å –µ—â—ë –±–æ–ª—å—à–µ Spring-like)?